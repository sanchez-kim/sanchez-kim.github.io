<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><title>TTS | Sanchez</title><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="TTS" /><meta property="og:locale" content="en_US" /><meta name="description" content="Sanchez의 개발관련 끄적끄적" /><meta property="og:description" content="Sanchez의 개발관련 끄적끄적" /><link rel="canonical" href="http://localhost:4000/docs/%08AI/TTS/" /><meta property="og:url" content="http://localhost:4000/docs/%08AI/TTS/" /><meta property="og:site_name" content="Sanchez" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TTS" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Sanchez의 개발관련 끄적끄적","headline":"TTS","url":"http://localhost:4000/docs/%08AI/TTS/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> Sanchez </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in AI Research category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/AI/Research" class="nav-list-link">AI Research</a><ul class="nav-list"><li class="nav-list-item "><a href="/docs/%08AI/GazeEstimation/" class="nav-list-link">Gaze Estimation</a><li class="nav-list-item "><a href="/docs/%08AI/StableDiffusion/" class="nav-list-link">Stable Diffusion</a><li class="nav-list-item "><a href="/docs/%08AI/TalkingFaceGeneration/" class="nav-list-link">Talking Face Generation</a><li class="nav-list-item active"><a href="/docs/%08AI/TTS/" class="nav-list-link active">TTS</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Note category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/Note" class="nav-list-link">Note</a><ul class="nav-list"><li class="nav-list-item "><a href="/docs/Note/Issues/" class="nav-list-link">Issues</a><li class="nav-list-item "><a href="/docs/Note/ETC/" class="nav-list-link">ETC</a></ul><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></ul><ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/sanchez-kim" class="nav-list-link external"> Sanchez Kim on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Sanchez" aria-label="Search Sanchez" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/sanchez-kim" class="site-button" > Sanchez Kim on Github </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/AI/Research">AI Research</a><li class="breadcrumb-nav-list-item"><span>TTS</span></ol></nav><div id="main-content" class="main-content" role="main"><p class="label label-yellow">RESEARCH</p><p class="label label-green">ON-PROGRESS</p><h1 id="tts-프로젝트-개요"> <a href="#tts-프로젝트-개요" class="anchor-heading" aria-labelledby="tts-프로젝트-개요"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TTS 프로젝트 개요</h1><ul><li>KSS(Korean Single Speaker)데이터셋으로 구현된 모델은 흔하게 찾아볼 수 있으나 남성 목소리에 대한 구현체는 찾아보기가 어려워서 직접 학습해보고 테스트해보려한다.<li>데이터는 음성과 스크립트의 페어가 필요한데 좋은 데이터가 드물어서 서칭끝에 AI hub의 카이스트 오디오북 데이터셋을 활용하기로 결정.<li>추후 한국어 TTS 개발을 위한 데이터셋 전처리 코드도 정리해볼 예정이다. 구현되어있는 코드가 대부분 kss 기준으로 되어있는데 개인적으로는 좀 구조가 불편하게 되어있어서 다른 데이터셋에 적용시키기가 좀 귀찮더라.</ul><hr /><h1 id="fastspeech2"> <a href="#fastspeech2" class="anchor-heading" aria-labelledby="fastspeech2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> FastSpeech2</h1><h4 id="fastspeech2-의-모델-구조"> <a href="#fastspeech2-의-모델-구조" class="anchor-heading" aria-labelledby="fastspeech2-의-모델-구조"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> FastSpeech2 의 모델 구조</h4><p><img src="/assets/images/tts/fastspeech2.png" alt="" /> <br /></p><ul><li>Non-autogressive 방식의 TTS 모델.<li>애초에 입력값이 텍스트 뿐이기 떄문에 하나의 텍스트로 여러가지 형태의 음성이 나올 수 있으므로 one-to-many mapping problem에 해당한다.<li>Variation Adaptor를 도입하면서 phoneme hidden sequence에 energy, pitch, duration 등 여러가지 정보를 학습에 활용할 수 있게 되었고 좀 더 정확한 speech를 예측할 수 있게 되었다.<li>오리지널 버전은 미리 학습된 autoregressive 방식의 teacher model을 이용하는 것이 아니라 MFA(Montreal Forced Aligner) 방식으로 문장의 duration 정보를 강제 정렬하여 더 정확하게 duration을 예측한다.</ul><div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="/assets/images/tts/alignment_training_step.gif" alt="" /><tbody><tr><td style="text-align: center"><em>강제 정렬 과정</em></table></div><hr /><h1 id="프로젝트-절차"> <a href="#프로젝트-절차" class="anchor-heading" aria-labelledby="프로젝트-절차"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 프로젝트 절차</h1><h2 id="data-processing"> <a href="#data-processing" class="anchor-heading" aria-labelledby="data-processing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Processing</h2><h3 id="1-오픈데이터-다운로드"> <a href="#1-오픈데이터-다운로드" class="anchor-heading" aria-labelledby="1-오픈데이터-다운로드"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. 오픈데이터 다운로드</h3><ul><li><a href="https://aihub.or.kr/aihubdata/data/view.do?currMenu=120&amp;topMenu=100&amp;dataSetSn=290&amp;aihubDataSe=extrldata">AI Hub 카이스트 오디오북 데이터셋</a>에 가면 다운로드 가능하다.<li>여기서 남자 성우 중 한명을 선택하여 오디오파일과 스크립트를 정리하였다.<li>AI Hub에 올라가있는 데이터다보니 나름 잘 정리되어있지만 누락된 데이터도 있으니 꼭 확인을 꼼꼼하게 하길 바란다.</ul><h3 id="2-textgrid-만들기"> <a href="#2-textgrid-만들기" class="anchor-heading" aria-labelledby="2-textgrid-만들기"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. TextGrid 만들기</h3><ul><li>FastSpeech2를 학습시키기 위해서는 phoneme-utterance sequence간의 alignment 정보가 필요한데 이를 TextGrid라고 한다.<li>TextGrid는 MFA를 사용해서 추출할 수 있다.<li>MFA 설치는 <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/">공식 문서</a>를 참고해서 설치하는 것이 가장 깔끔하다.. 개인적으로는 도커를 활용하였다.<li>TextGrid를 추출하기 위해서는 MFA 학습용 데이터셋을 만들어야하는데 이때 원본 오디오파일과 그 오디오파일에 해당하는 스크립트, 그리고 음소(phoneme) 단위의 딕셔너리가 필요하다.</ul><div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="/assets/images/tts/kss_phoneme.png" alt="" /><tbody><tr><td style="text-align: center"><em>kss 데이터셋을 음소 단위로 변환한 예</em></table></div><ul><li>딕셔너리 제작시에 MFA로 g2p 모델을 학습시켜서 변환시키는 방법도 있지만 학습시간이 너무 오래걸리기 때문에 되도록이면 <a href="https://github.com/Kyubyong/g2pK">g2pk</a>를 사용해서 미리 한글을 위의 그림처럼 phoneme으로 변환시켜 놓자.<li>아래의 커맨드를 통해 최종적으로 TextGrid를 획득할 수 있다.</ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mfa train <span class="o">[</span>dataset_path] <span class="o">[</span>dictionary_path] <span class="o">[</span>save_model_path]
</code></pre></div></div><blockquote></blockquote><ul><li><em>dataset_path</em> : 오디오, 스크립트 쌍(wav, lab)이 존재하는 디렉토리의 경로<li><em>dictionary_path</em> : g2pk로 만든 딕셔너리 파일의 경로<li><em>save_model_path</em> : 학습 완료 후 모델을 저장할 경로</ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mfa align <span class="o">[</span>dataset_path] <span class="o">[</span>dict_file_path] <span class="o">[</span>model_path] <span class="o">[</span>result_path]
</code></pre></div></div><blockquote></blockquote><ul><li><em>dataset_path</em> : 학습 시킬 때 사용했던 데이터 경로와 동일<li><em>dict_file_path</em> : train 결과롤 생성된 *.dict 파일의 경로<li><em>model_path</em> : 학습된 모델 파일의 경로<li><em>result_path</em> : TextGrid를 저장할 경로</ul><div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="/assets/images/tts/textgrid.png" alt="" width="300" /><tbody><tr><td style="text-align: center"><em>생성된 TextGrid 예시</em></table></div><hr /><h3 id="3-preprocessing"> <a href="#3-preprocessing" class="anchor-heading" aria-labelledby="3-preprocessing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Preprocessing</h3><ul><li>TextGrid를 만들었다고 끝난게 아니다. <del>이제시작이다..</del><li>TextGrid가 준비되었으면 데이터셋의 형태에 맞게 (kss데이터셋의 포맷을 따라가는게 편리함) 전처리를 진행하자.</ul><div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="/assets/images/tts/preprocessed_folder.png" alt="" width="300" /><tbody><tr><td style="text-align: center"><em>전처리 후 폴더구조</em></table></div><hr /><h2 id="training"> <a href="#training" class="anchor-heading" aria-labelledby="training"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Training</h2><div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="/assets/images/tts/training_loss.png" alt="" /><tbody><tr><td style="text-align: center"><em>학습결과</em></table></div><ul><li>보코더는 한국인 남성의 목소리를 학습시킨 모델이 없어서 <a href="https://github.com/rishikksh20/VocGAN">VocGAN</a>의 영어 다화자 사전학습 모델을 사용하였다.<ul><li><em>추후 <a href="https://github.com/lmnt-com/diffwave">diffwave</a> 기반 모델 테스트 예정</em></ul><li>학습용 데이터의 수량은 training set 9,115건, validation set 1,951건으로 결코 많은 양은 아닌 듯 하다.<li>하이퍼파라미터가 굉장히 많은데(attention head, dropout, learning rate 등등), 하나하나 테스트해보기에는 너무 시간이 오래걸리므로 <a href="https://github.com/HGU-DLLAB/Korean-FastSpeech2-Pytorch">HGU-DLLAB의 Jackson Kang님의 코드</a>에 수록되어있는 파라미터를 대부분 그대로 적용하였다.<li>3000 epoch으로 총 180만 스텝을 학습시키게 되었다.</ul><h3 id="학습결과-분석"> <a href="#학습결과-분석" class="anchor-heading" aria-labelledby="학습결과-분석"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 학습결과 분석</h3><ul><li>데이터의 글자 빈도 수에 따라서 발화가 결정되는 케이스 존재 \(\rightarrow\) overfitting 우짜꼬..<li>loss 만으로는 학습이 잘 되었는지 판별이 불가.<li>데이터 전처리에 따라서 품질이 달라질 수 있을듯..</ul><hr /><h1 id="references"> <a href="#references" class="anchor-heading" aria-labelledby="references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> References</h1><ul><li><a href="https://github.com/ming024/FastSpeech2">ming024’s implementation</a><li><a href="https://github.com/HGU-DLLAB/Korean-FastSpeech2-Pytorch">HGU-DLLAB’s implementation for Korean</a></ul><script src="https://utteranc.es/client.js" repo="sanchez-kim/sanchez-kim.github.io" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><div class="d-flex mt-2"></div></footer><footer> Copyright &copy; 2023 Sanchez Kim. Distributed by an <a href="https://creativecommons.org/licenses/by-nc-sa/3.0">CC BY-NC-SA 3.0</a> license</footer></div></div><div class="search-overlay"></div></div><script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
